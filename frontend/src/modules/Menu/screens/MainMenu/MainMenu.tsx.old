import React from 'react';
import { useState, useMemo } from 'react';
import { Fade, IconButton, Button, Collapse, Paper, MenuList, MenuItem } from '@material-ui/core';
import FolderIcon from '@material-ui/icons/Folder';
import { FileManager } from 'modules/FileManager/fileManager';
import { TextField, FormLabel, InputAdornment } from '@material-ui/core';
import { useTheme } from '@material-ui/core/styles';
import { useLoadProject } from 'backend/projectManagement';
import { FileType } from 'modules/FileManager/Types';
import useStyles from './MainMenu.css';
import { MainMenuProps } from './Types';
const OptionsInfo: React.FunctionComponent<OptionsInfoTypes> = ({ optionName, selectOption }) => {
    switch (optionName) {
        case 'Create Project':
            return (
                <>
                    <MenuList>
                        <MenuItem
                            onClick={() => {
                                selectOption('onecpp');
                            }}
                        >
                            New project from one .cpp file
                        </MenuItem>
                        <MenuItem
                            onClick={() => {
                                selectOption('empty');
                            }}
                        >
                            New empty project
                        </MenuItem>
                        <MenuItem
                            onClick={() => {
                                selectOption('manycpp');
                            }}
                        >
                            New project from many .cpp files
                        </MenuItem>
                    </MenuList>
                </>
            );
        case 'Save As':
            return (
                <>
                    <form style={{ display: 'flex', flexDirection: 'column' }}>
                        <div style={{ paddingBottom: '6px', fontSize: '24px' }}>Save as</div>
                        <TextField label="Project name" />
                        <TextField
                            label="Project location"
                            InputProps={{
                                endAdornment: (
                                    <InputAdornment position="end">
                                        <IconButton>
                                            <FolderIcon />
                                        </IconButton>
                                    </InputAdornment>
                                ),
                            }}
                        />
                        <Button style={{ padding: '3px', marginTop: '2px' }}>Confirm</Button>
                        <div style={{ paddingTop: '6px', paddingBottom: '5px', fontSize: '18px', opacity: 0.7 }}>Optional</div>
                        <TextField
                            label="Project description"
                            placeholder="nlogn solve testing"
                            InputLabelProps={{
                                shrink: true,
                            }}
                        />
                        <TextField label="Project author" />
                    </form>
                </>
            );
        case 'Open Project':
            return (
                <>
                    <MenuList>
                        <MenuItem
                            onClick={() => {
                                selectOption('openproject');
                            }}
                        >
                            Open project
                        </MenuItem>
                    </MenuList>
                </>
            );
        default:
            return <></>;
    }
    return <></>;
};

export const MainMenu: React.FunctionComponent<MainMenuProps> = ({ open, handleClose, isAnyProjectOpen, socket }) => {
    const [optionInfo, setOptionInfo] = useState<ButtonsOptions>(ButtonsOptions.Op);
    const [selectedOption, selectOption] = useState<>()
    const defaultFileManagerConfig = {
        isOpen: false,
        maxNumberOfFiles: 1,
        onSelectFiles: () => {},
    };
    const [fileManagerConfig, changeFileManagerConfig] = useState<{
        isOpen: boolean;
        maxNumberOfFiles: number;
        onSelectFiles: (v: string[]) => any;
        availableFilesTypes?: Array<string> | undefined;
        acceptableFileTypes?: Array<string> | undefined;
    }>(defaultFileManagerConfig);

    const createProject = (files?: Array<string>) => {
        if (socket) {
            socket.send(
                JSON.stringify({
                    type: 'createNewProject',
                    data: {
                        name: 'Pies',
                        path: '/cds',
                        description: 'My first solve',
                        author: 'Jozek Kowalski',
                    },
                })
            );
        } else console.log('connection error');
    };

    const createProjectFromOneFile = () => {
        changeFileManagerConfig({
            maxNumberOfFiles: 1,
            onSelectFiles: createProject,
            isOpen: true,
            acceptableFileTypes: ['.cpp'],
            availableFilesTypes: ['DIRECTORY', '.cpp'],
        });
    };

    const createProjectFromManyFiles = () => {
        changeFileManagerConfig({
            maxNumberOfFiles: Infinity,
            onSelectFiles: createProject,
            isOpen: true,
            acceptableFileTypes: ['.cpp'],
            availableFilesTypes: ['DIRECTORY', '.cpp'],
        });
    };

    /********************************
     *          OPEN PROJECT          *
     ********************************/

    const LoadProject = useLoadProject();

    const SelectPathToOpenProject = (selectedFiles: Array<FileType>) => {
        if (selectedFiles.length) LoadProject(selectedFiles[0].path);
    };

    const OpenProject = () => {
        /*changeFileManagerConfig({
            maxNumberOfFiles: Infinity,
            onSelectFiles: SelectPathToOpenProject,
            isOpen: true,
            availableFilesTypes: ['DIRECTORY', '.cdsp'],
            acceptableFileTypes: ['.cdsp'],
        });*/
    };

    const optionsFunctionsGroups = {
        'Create Project': (option: string) => {
            switch (option) {
                case 'onecpp':
                    createProjectFromOneFile();
                    return;
                case 'manycpp':
                    createProjectFromManyFiles();
                    return;
                case 'empty':
                    createProject();
                    return;
                default:
                    return;
            }
        },
        'Open Project': (option: string) => {
            switch (option) {
                case 'openproject':
                    OpenProject();
                    return;
                default:
                    return;
            }
        },
    };

    const classes = useStyles({
        open: open,
    });
    const theme = useTheme();
    switch()
    //                <IconButton style = {{color: "red", right: "2px", top: "2px", position: "absolute", padding: "0px"}} onClick = { ()=>{handleClose()} }><CloseIcon/></IconButton>
    //style = {{display: "flex", border: "solid 1px", left: "60px", position: "relative", zIndex: 1201, top: "65px", minWidth: "800px", minHeight: "400px", backgroundColor: "white", flexDirection: "row"}}
    return useMemo(
        () => (
            <>
                <div className={classes.mainMenu}>
                    <MenuList className={classes.mainMenuOptionsList}>
                        {Buttons.map((obj, index) => {
                            return (
                                <MenuItem
                                    key={`MainMenuOption-${index}`}
                                    disabled={obj.doesNeedOpenProject && !isAnyProjectOpen}
                                    onClick={() => {
                                        setOptionInfo(obj.name);
                                    }}
                                    className={classes.menuItem}
                                    style={{
                                        backgroundColor:
                                            obj.name === optionInfo
                                                ? theme.palette.mainMenu.selectedButtonBackgroundColor
                                                : 'transparent',
                                    }}
                                >
                                    {React.cloneElement(obj.icon, {
                                        style: { color: theme.palette.mainMenu.iconColorEnabled },
                                    })}
                                    <span style={{ paddingLeft: '10px' }}>{obj.name}</span>
                                </MenuItem>
                            );
                        })}
                    </MenuList>
                    <Fade in={optionInfo ? true : false} timeout={2000}>
                        <div style={{ color: theme.palette.mainMenu.fontColor, padding: '20px' }}>
                            {MenuOptionContent}
                        </div>
                    </Fade>
                </div>
                {fileManagerConfig.isOpen ? (
                    <FileManager
                        maxNumberOfSelectedFiles={fileManagerConfig.maxNumberOfFiles}
                        selectFiles={fileManagerConfig.onSelectFiles}
                        loadDirectoryOnStart={'/'}
                        isFileManagerOpen={fileManagerConfig.isOpen}
                        dialogClose={() => {
                            changeFileManagerConfig(defaultFileManagerConfig);
                        }}
                        availableFilesTypes={fileManagerConfig.availableFilesTypes}
                        acceptableFileTypes={fileManagerConfig.acceptableFileTypes}
                    />
                ) : null}
            </>
        ),
        [optionInfo, fileManagerConfig, open, isAnyProjectOpen, theme, classes]
    );
};

export default MainMenu;
